{% extends 'layout.html' %}
{% block css %}
  <link rel="stylesheet" type="text/css" href="update_user.css">
{% endblock %}
{% block javascript_specific %}
  <script type="text/javascript" src="js/update_user.js"></script>
{% endblock %}
{% block pagetitle %}
  Update user : {{ session.username }}
{% endblock %}
{% block main %}
{% from "_formhelpers.html" import render_field %}
{% from "_formhelpers.html" import render_table_field %}
<nav id="update_choices">
  <ul>
    <li onclick='display_form("gen_info")'>general_infos</li>
    <li onclick='display_form("address")'>address</li>
    <li onclick='display_form("phone")'>phone</li>
    <li onclick='display_form("mail")'>mail</li>
    <li onclick='display_form("password_container")'>password</li>
  </ul>
</nav>
<div id="update_user">
  <div id="gen_info">
    <form method="post" action='/user/update_user/id={{user.id}}/'>
      <dl>
      {% if session.role == role_admin %}
        {{ render_field(gen_info_form.username, autofocus="autofocus", value=user.username) }}
      {% endif %}
      {{ render_field(gen_info_form.title, value=user.title) }}
      {{ render_field(gen_info_form.lastname, value=user.lastname) }}
      {{ render_field(gen_info_form.firstname, value=user.firstname) }}
      {{ render_field(gen_info_form.sex, value=user.sex) }}
      {{ render_field(gen_info_form.dob, value=user.dob) }}
      {{ render_field(gen_info_form.qualifications, value=user.qualifications) }}
      {{ render_field(gen_info_form.correspondence_name, value=user.correspondence_name) }}
      {{ render_field(gen_info_form.avatar_id, value=user.avatar_id) }}
      {% if session.role == role_dentist or session.role == role_admin %}
        {{ render_field(gen_info_form.registration, value=user.registration) }}
      {% endif %}
      {% if session.role == role_admin %}
        {{ render_field(gen_info_form.status, value=user.status) }}
        {{ render_field(gen_info_form.role, value=user.role) }}
        {{ render_field(gen_info_form.comments, value=user.comments) }}
        {{ render_field(gen_info_form.modified_by, value=user.modified_by) }}
      {% endif %}
      <input type=submit value="Update" />
     </dl>
    </form>
  </div>
  <div id="phone">
    <table>
      <tr>
        <th class="hidden">id</th>
        <th>name</th>
        <th>number</th>
        <th>action</th>
      </tr>
      {% for phone in user.phones %}
      <tr>
        <form method="post" action="/user/update_user_phone/id={{user.id}}/">
          <td class="hidden"><input type="text" name="phone_id" value={{loop.index0}} /></td>
          {{ render_table_field(phone_form.phonename, value=phone.name) }}
          {{ render_table_field(phone_form.phonenum, value=phone.number) }}
          <td><input type="submit" value="Update" /></td>
          <td><input type="submit" action="/user/delete_user_phone/id={{user.id}}/" value="Delete" /></td>
        </form>
      </tr>
      {% endfor %}
      <tr>
        <form method="post" action="/user/add_user_phone/id={{user.id}}/">
          <td class="hidden"></td>
          {{ render_table_field(phone_form.phonename) }}
          {{ render_table_field(phone_form.phonenum) }}
          <td><input type="submit" value="Add new phone" />
        </form>
      </tr>
    </table>
  </div>
  <div id="address">
    <table>
      <tr>
        <th class="hidden">id</th>
        <th>street</th>
        <th>building</th>
        <th>city</th>
        <th>postal_code</th>
        <th>county</th>
        <th>country</th>
      </tr>
      {% for address in user.addresses %}
      <tr>
        <form method="post" action="/user/update_user_address/id={{user.id}}/">
          <td class="hidden"><input type="text" name="address_id" value={{loop.index0}} /></td>
          {{ render_table_field(address_form.street, value=address.street) }}
          {{ render_table_field(address_form.building, value=address.building) }}
          {{ render_table_field(address_form.city, value=address.city) }}
          {{ render_table_field(address_form.postal_code, value=address.postal_code) }}
          {{ render_table_field(address_form.county, value=address.county) }}
          {{ render_table_field(address_form.country, value=address.country) }}
          <td><input type=submit value="Update" /></td>
        </form>
      </tr>
      {% endfor %}
      <tr>
        <form method=post action="/user/add_user_address/id={{user.id}}/">
          <td class="hidden"></td>
          {{ render_table_field(address_form.street) }}
          {{ render_table_field(address_form.building) }}
          {{ render_table_field(address_form.city) }}
          {{ render_table_field(address_form.postal_code) }}
          {{ render_table_field(address_form.county) }}
          {{ render_table_field(address_form.country) }}
          <td><input type=submit value="Add new address" /></td>
        </form>
      </tr>
    </table>
  </div>
  <div id="mail">
    <table>
      <tr>
        <th class="hidden">id</th>
        <th>Email</th>
        <th>Action</th>
      </tr>
      {% for mail in user.mails %}
      <tr>
        <form method="post" action="/user/update_user_mail/id={{user.id}}/">
          <td class="hidden"><input type="text" name="mail_id" value={{loop.index0}} /></td>
          {{ render_table_field(mail_form.email, value=mail.email) }}
          <td><input type=submit value="Update" /></td>
        </form>
      </tr>
      {%endfor%}
      <tr>
        <form method=post action="/user/add_user_mail/id={{user.id}}/">
          <td class="hidden"></td>
          {{ render_table_field(mail_form.email) }}
          <td><input type=submit value="Add new email" /></td>
        </form>
      </tr>
    </table>
  </div>
  <div id="password_container">
    <form method="post" action="/user/update_user_password/id={{user.id}}/">
      <dl>
        {{ render_field(password_form.password) }}
        {{ render_field(password_form.confirm) }}
      </dl>
      <input type="submit" value="Change password" />
    </form>
  </div>
</div>
{% endblock %}

